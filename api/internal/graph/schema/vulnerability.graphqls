"""
Vulnerability management types and operations.
"""

type Vulnerability implements Node {
  id: ID!
  title: String!
  description: String!
  source: String!
  cveIds: [String!]!
  externalRefs: String
  cvssScore: Float
  cvssVector: String!
  severity: String
  status: String!
  discoveryDate: Time
  dueDate: Time
  closureDate: Time
  owner: User
  analyst: User
  approver: User
  tags: [String!]!
  notes: String!
  createdAt: Time!
  updatedAt: Time!
  assets(first: Int, after: String): AssetConnection!
  comments(first: Int, after: String): CommentConnection!
  evidence(first: Int, after: String): EvidenceConnection!
  history(first: Int, after: String): VulnerabilityHistoryConnection!
}

type VulnerabilityConnection {
  edges: [VulnerabilityEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type VulnerabilityEdge {
  cursor: String!
  node: Vulnerability!
}

type VulnerabilityHistory implements Node {
  id: ID!
  fieldName: String!
  oldValue: String!
  newValue: String!
  changedBy: User
  changedAt: Time!
}

type VulnerabilityHistoryConnection {
  edges: [VulnerabilityHistoryEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type VulnerabilityHistoryEdge {
  cursor: String!
  node: VulnerabilityHistory!
}

extend type Query {
  vulnerabilities(first: Int, after: String, filter: VulnFilter): VulnerabilityConnection!
  vulnerability(id: ID!): Vulnerability
}

extend type Mutation {
  createVulnerability(input: CreateVulnerabilityInput!): Vulnerability!
  updateVulnerability(id: ID!, input: UpdateVulnerabilityInput!): Vulnerability!
  deleteVulnerability(id: ID!): Boolean!
  assignVulnerabilityOwner(id: ID!, ownerId: ID!): Vulnerability!
  bulkUpdateVulnerabilities(ids: [ID!]!, input: BulkVulnUpdateInput!): [Vulnerability!]!
}

input VulnFilter {
  severity: String
  status: String
  assetId: ID
  ownerId: ID
  cveId: String
  tags: [String!]
  search: String
  discoveredAfter: Time
  discoveredBefore: Time
}

input CreateVulnerabilityInput {
  title: String!
  description: String
  source: String
  cveIds: [String!]
  cvssScore: Float
  cvssVector: String
  severity: String
  discoveryDate: Time
  dueDate: Time
  ownerId: ID
  analystId: ID
  tags: [String!]
  notes: String
  assetIds: [ID!]
}

input UpdateVulnerabilityInput {
  title: String
  description: String
  source: String
  cveIds: [String!]
  cvssScore: Float
  cvssVector: String
  severity: String
  status: String
  dueDate: Time
  closureDate: Time
  ownerId: ID
  analystId: ID
  approverId: ID
  tags: [String!]
  notes: String
}

input BulkVulnUpdateInput {
  status: String
  ownerId: ID
  tags: [String!]
}
